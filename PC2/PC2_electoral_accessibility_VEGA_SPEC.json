{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "config": {
    "view": {"strokeOpacity": 0},
    "concat": {"spacing": 80}
  },
  "title": {
    "text": "Electoral Accessibility for PWDs in India",
    "subtitleFontWeight": "normal",
    "fontSize": 16,
    "subtitleFontSize": 12,
    "dx": 50,
    "subtitle": [
      "Left shows PWD Electors & Home Voting %; right shows geographic distribution.",
      "Purple = high accessibility. Dark red = crisis (low home voting access).",
      ""
    ]
  },
  "data": {
    "url": "https://cdn.jsdelivr.net/gh/udit-001/india-maps-data@8d907bc/topojson/india.json",
    "format": {"feature": "states", "type": "topojson"}
  },
  "transform": [
    {
      "lookup": "properties.st_nm",
      "from": {
        "fields": [
          "state",
          "pwd_electors",
          "home_voting_pct",
          "pwd_percentage",
          "female_male_ratio",
          "total_electors",
          "region",
          "male",
          "female",
          "transgender"
        ],
        "data": {
          "url": "https://raw.githubusercontent.com/c-malhotra/c-malhotra.github.io/refs/heads/main/PC2/PC2_pwd_voter_data.json"
        },
        "key": "state"
      }
    },
    {
      "filter": "datum.pwd_electors > -1"
    }
  ],
  "hconcat": [
    {
      "width": 450,
      "height": 550,
      "encoding": {
        "x": {
          "field": "pwd_electors",
          "axis": {
            "titleFontWeight": "normal",
            "gridOpacity": 0.3,
            "tickOpacity": 0,
            "labelFontWeight": "lighter",
            "labelExpr": "format(datum.value/1000, '.0f')+'K'"
          },
          "type": "quantitative",
          "title": "PWD Electors"
        },
        "y": {
          "field": "home_voting_pct",
          "axis": {
            "titleFontWeight": "normal",
            "gridOpacity": 0.3,
            "tickOpacity": 0,
            "labelFontWeight": "lighter",
            "labelExpr": "datum.value+'%'"
          },
          "scale": {
            "domain": [0, 30]
          },
          "type": "quantitative",
          "title": "% Voted from Home"
        }
      },
      "layer": [
        {
          "params": [
            {
              "name": "point_paintbrush",
              "select": {
                "type": "point",
                "fields": ["state"],
                "on": "pointerover"
              }
            },
            {"name": "grid", "select": "interval", "bind": "scales"}
          ],
          "encoding": {
            "color": {
              "field": "home_voting_pct",
              "type": "quantitative",
              "scale": {
                "domain": [0, 30],
                "range": ["#7f1d1d", "#dc2626", "#f59e0b", "#a855f7", "#7c3aed"]
              }
            },
            "opacity": {
              "condition": {
                "param": "point_paintbrush",
                "value": 1
              },
              "value": 0.2
            }
          },
          "mark": {
            "type": "circle",
            "stroke": "rgba(0,0,0,0.8)",
            "strokeWidth": 0.5,
            "size": 50,
            "tooltip": {
              "expr": "{'State': datum.state, 'PWD Electors': format(datum.pwd_electors, ','), 'Home Voting': format(datum.home_voting_pct, '.2f')+'%', 'Gender Ratio': format(datum.female_male_ratio, '.3f'), 'Region': datum.region}"
            }
          }
        },
        {
          "mark": {
            "type": "text",
            "opacity": 1,
            "color": "black",
            "fontWeight": "lighter",
            "align": "left",
            "dx": 5
          },
          "transform": [{"filter": "datum.state == point_paintbrush.state"}],
          "encoding": {
            "text": {"field": "state"},
            "opacity": {"value": 1},
            "color": {"value": "black"}
          }
        }
      ]
    },
    {
      "height": 550,
      "width": 450,
      "layer": [
        {
          "params": [
            {
              "name": "point_paintbrush",
              "select": {
                "type": "point",
                "fields": ["state"],
                "on": "pointerover"
              }
            }
          ],
          "mark": {
            "type": "geoshape",
            "tooltip": {
              "expr": "{'State': datum.properties.st_nm, 'PWD Electors': datum.pwd_electors ? format(datum.pwd_electors, ',') : 'Missing', 'Home Voting': datum.home_voting_pct ? format(datum.home_voting_pct, '.2f')+'%' : 'Missing', 'Accessibility': datum.home_voting_pct >= 10 ? 'High' : datum.home_voting_pct >= 5 ? 'Moderate' : datum.home_voting_pct >= 2 ? 'Low' : 'Crisis'}"
            },
            "color": "red",
            "stroke": "grey"
          },
          "encoding": {
            "strokeWidth": {
              "condition": [
                {"test": "datum.state == point_paintbrush.state", "value": 1}
              ],
              "value": 0
            },
            "opacity": {
              "condition": [
                {
                  "test": "datum.state == point_paintbrush.state | !isValid(point_paintbrush.state)",
                  "value": 1
                }
              ],
              "value": 0.2
            },
            "color": {
              "field": "home_voting_pct",
              "legend": {
                "titleFontWeight": "lighter",
                "orient": "none",
                "legendX": 260,
                "legendY": -5,
                "title": "Home Voting %",
                "format": ".1f"
              },
              "scale": {
                "domain": [0, 15, 30],
                "domainMid": 5,
                "type": "linear",
                "range": ["#7f1d1d", "#fbbf24", "#7c3aed"]
              },
              "type": "quantitative"
            }
          }
        }
      ]
    }
  ]
}
